# 프롬프트 컨텍스트 작동 원리

## 개요

프롬프트 컨텍스트는 AI 에이전트의 대화 맥락을 효율적으로 관리하기 위해 만들어진 지능형 MCP 시스템입니다. 이 문서에서는 시스템의 기본 아키텍처와 주요 구성 요소를 설명합니다.

## 주요 구성 요소

### 컨텍스트 서비스

컨텍스트 서비스는 시스템의 핵심으로, 아래와 같은 역할을 담당합니다:

- 메시지 저장 및 검색 관리
- 메시지가 일정 수에 도달하면 자동으로 요약 실행
- 다른 구성 요소들과의 조율
- 중요도 기반의 데이터 보존 정책 적용
- 다양한 대화 맥락 간 관계 추적

### 리포지토리 시스템

리포지토리 계층은 다음과 같이 데이터를 영구적으로 저장합니다:

- **파일 시스템 리포지토리**: JSON 포맷으로 원시 대화 데이터와 메타데이터를 저장
- **벡터 리포지토리**: 시맨틱 검색을 위한 벡터 임베딩 관리
- **그래프 리포지토리**: 대화 맥락들 간의 관계를 추적

이들 리포지토리는 대화 기록과 주제 간의 관계를 종합적으로 관리합니다.

### 도구 구현

MCP 서버는 AI 에이전트가 사용할 수 있는 다양한 도구를 제공합니다:

- **컨텍스트 관리**: `add_message`, `retrieve_context`, `summarize_context`
- **관계 도구**: `add_relationship`, `get_related_contexts`
- **검색 도구**: `get_similar_contexts`, `visualize_context`
- **분석 도구**: `get_context_metrics`

각 도구는 컨텍스트 서비스와 리포지토리의 특정 기능과 연계되어 동작합니다.

## 주요 기능

### 자동 요약

대화 맥락이 설정된 임계값(기본값: 메시지 10개)에 도달하면 다음과 같이 동작합니다:

1. 요약 프로세스가 실행됩니다.
2. 태그와 중요도에 따라 핵심 메시지를 식별합니다.
3. 식별된 메시지를 기반으로 요약을 생성, 저장합니다.
4. 생성된 요약은 이후 대화 검색에 활용됩니다.

### 벡터 유사도 검색

시맨틱 검색 기능은 다음 과정을 거칩니다:

1. 텍스트를 수치 벡터(임베딩)로 변환
2. 효율적인 검색을 위해 임베딩 데이터를 인덱싱
3. 쿼리와 저장된 데이터 간의 유사도 점수를 계산
4. 시맨틱 의미에 따라 관련성이 높은 대화 맥락을 반환

### 그래프 관계 추적

관계 추적 시스템은 다음을 수행합니다:

1. 대화 맥락 간의 명시적 관계(예: 유사, 참조, 연속, 부모/자식)를 저장
2. 관련 주제 간의 탐색을 지원
3. 대화 기록의 지식 그래프를 구축
4. 양방향 탐색 기능을 제공

## 구성 방법

시스템은 CLI 인수, 환경 변수, 구성 파일 등 다양한 방법으로 설정할 수 있으며, 기본값은 합리적으로 설정되어 있습니다. 자세한 구성 옵션은 [README](../../README.md)를 참고하세요.
