# 프롬프트 컨텍스트 작동 방식

## 개요

프롬프트 컨텍스트는 대화와 관련 정보를 지능적으로 관리하고 검색하는 시스템입니다. 이 문서는 시스템의 핵심 구성 요소와 각 기술이 선택된 이유, 그리고 이들이 어떻게 함께 작동하여 통합된 시스템을 구성하는지 설명합니다.

## 주요 구성 요소와 기술 선택

### 메모리 컨텍스트 프로토콜(MCP)

**이 기술을 선택한 이유**: MCP는 전통적인 데이터베이스 시스템이 미묘한 대화 관리에 필요한 맥락적 이해가 부족하기 때문에 중앙 조정자 역할을 합니다. 우리는 대화 단편 간의 관계를 유지하면서 무엇을 보존하고 무엇을 요약할지에 대한 지능적인 결정을 내릴 수 있는 프로토콜이 필요했습니다.

**다른 구성 요소와의 연결**: MCP는 다음과 같은 시점에 결정을 내리며 모든 다른 구성 요소를 조율합니다:
- 요약기에 대화 압축 요청
- 벡터 저장소에 새 콘텐츠 인덱싱 트리거
- 파일 시스템 저장소를 사용하여 데이터 지속

### 벡터 데이터베이스

**이 기술을 선택한 이유**: 전통적인 관계형 데이터베이스는 정확한 일치에 뛰어나지만 의미적 유사성에는 어려움을 겪습니다. 벡터 데이터베이스는 텍스트의 의미를 수학적으로 표현할 수 있어 정확한 단어가 다르더라도 관련 개념을 찾을 수 있기 때문에 선택되었습니다.

**다른 구성 요소와의 연결**: 
- MCP에서 처리된 텍스트를 수신
- 대화 및 요약에서 생성된 임베딩 저장
- 컨텍스트 검색을 위해 MCP에 유사성 결과 제공
- 관련 정보의 웹을 만들기 위해 그래프 데이터베이스와 함께 작동

### 그래프 데이터베이스

**이 기술을 선택한 이유**: 벡터 유사성이 관련 콘텐츠를 찾는 반면, 컨텍스트 간의 명시적인 관계는 캡처하지 못합니다. 그래프 데이터베이스는 관계를 표현하고 탐색하는 데 탁월하여 컨텍스트 A가 컨텍스트 B의 연속이거나 컨텍스트 C가 컨텍스트 D를 참조한다는 것을 이해할 수 있게 합니다.

**다른 구성 요소와의 연결**:
- MCP에서 관계 정보 수신
- 명시적 관계 구조를 추가하여 벡터 데이터베이스를 보완
- MCP가 정보의 계층적 구조화에 대한 결정을 내리는 데 도움 제공

### 요약기 서비스

**이 기술을 선택한 이유**: 완전한 대화를 무기한 저장하는 것은 비효율적이고 부담스러울 수 있습니다. 요약 기술은 핵심 요점을 보존하면서 정보를 압축하여 시스템을 더 확장 가능하고 집중적으로 만듭니다.

**다른 구성 요소와의 연결**:
- 대화가 특정 임계값에 도달하면 MCP에서 대화 수신
- 파일 시스템 저장소에 저장되는 요약 생성
- 효율적인 검색을 위해 이러한 요약을 벡터 데이터베이스에 제공
- 그래프 데이터베이스와 함께 작업할 때 계층적 요약 가능

### 파일 시스템 저장소

**이 기술을 선택한 이유**: 모든 것에 복잡한 데이터베이스 솔루션을 사용하는 대신, 간단한 파일 기반 저장 시스템은 신뢰성, 쉬운 백업, Git과 같은 버전 제어 시스템과의 호환성을 제공합니다. 이 선택은 단순성과 견고성을 우선시합니다.

**다른 구성 요소와의 연결**:
- 모든 다른 구성 요소에 대한 영구 저장소 제공
- 필요한 경우 쉬운 검사 및 수동 편집 허용
- 컨텍스트 이력 추적을 위한 버전 제어 통합 가능

## 이러한 기술들이 함께 작동하는 방식

1. **초기 대화 저장**: 
   - 대화가 시작되면 MCP는 고유한 컨텍스트 ID 생성
   - 원시 메시지는 파일 시스템 저장소에 저장
   - 그래프 데이터베이스는 이를 새로운 컨텍스트 노드로 추적 시작

2. **콘텐츠 처리 및 임베딩**: 
   - 콘텐츠가 누적되면 MCP는 이를 임베딩하기 위해 전송
   - 벡터 데이터베이스는 이러한 임베딩을 처리하고 저장
   - 이는 향후 의미적 검색 기능을 가능하게 함

3. **관계 감지**:
   - MCP는 다른 컨텍스트에 대한 참조를 위해 콘텐츠 분석
   - 발견되면 그래프 데이터베이스는 관계 링크 생성
   - 이러한 관계는 콘텐츠 유사성이나 명시적 참조에 기반할 수 있음

4. **요약 워크플로우**:
   - 대화가 임계값에 도달하면 MCP는 요약기 트리거
   - 요약기는 중요한 정보를 보존하면서 대화 분석
   - 이 요약은 향후 참조를 위해 저장되고 임베딩됨

5. **계층적 구성**:
   - 벡터 유사성과 그래프 관계를 모두 사용하여 MCP는 계층적 구조 구축
   - 관련 컨텍스트는 상위 수준의 이해를 위해 그룹화
   - 이는 인간 기억 구성을 모방하는 다단계 지식 구조 생성

6. **컨텍스트 검색 프로세스**:
   - 정보가 필요할 때 벡터 데이터베이스는 의미적으로 유사한 콘텐츠 찾음
   - 그래프 데이터베이스는 관계 컨텍스트 제공
   - MCP는 이러한 입력을 결합하여 가장 관련성 높은 정보 검색
   - 파일 시스템 저장소는 실제 콘텐츠 제공
